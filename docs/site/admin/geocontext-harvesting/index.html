<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta content="Kartoza and FRC" name="author"/>
<link href="../../img/favicon.ico" rel="shortcut icon"/>
<title>Harvesting GeoContext Data - BIMS</title>
<link href="../../css/bootstrap.min.css" rel="stylesheet"/>
<link href="../../css/font-awesome.min.css" rel="stylesheet"/>
<link href="../../css/base.css" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" rel="stylesheet"/>
<script defer="" src="../../js/jquery-1.10.2.min.js"></script>
<script defer="" src="../../js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<link href="../../../pdfs/TheBIMSHandbook.pdf" rel="alternate" title="PDF" type="application/pdf"/></head>
<body>
<div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
<div class="container">
<a class="navbar-brand" href="../..">BIMS</a>
<!-- Expander button -->
<button class="navbar-toggler" data-target="#navbar-collapse" data-toggle="collapse" type="button">
<span class="navbar-toggler-icon"></span>
</button>
<!-- Expanded navigation -->
<div class="navbar-collapse collapse" id="navbar-collapse">
<!-- Main navigation -->
<ul class="nav navbar-nav">
<li class="navitem">
<a class="nav-link" href="../..">Home</a>
</li>
<li class="dropdown">
<a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">Instances <b class="caret"></b></a>
<ul class="dropdown-menu">
<li>
<a class="dropdown-item" href="../../fbis/">FreshWaterBiodiversity.org</a>
</li>
<li>
<a class="dropdown-item" href="../../rbis/">Rwanda Biodiversity Information System</a>
</li>
<li>
<a class="dropdown-item" href="../../orbis/">Okavango Biodiversity Information System</a>
</li>
</ul>
</li>
<li class="navitem">
<a class="nav-link" href="../../user-docs/">User Documentation</a>
</li>
<li class="dropdown active">
<a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">Administrator Documentation <b class="caret"></b></a>
<ul class="dropdown-menu">
<li class="dropdown-submenu">
<a class="dropdown-item" href="#">Biodiversity Data</a>
<ul class="dropdown-menu">
<li>
<a class="dropdown-item" href="../biodiversity-data-overview/">Biodiversity Data Overview</a>
</li>
<li>
<a class="dropdown-item" href="../master-list-preparation/">Preparing and checking a Master List of Taxa before uploading</a>
</li>
<li>
<a class="dropdown-item" href="../occurence-data-preparation/">Preparing and checking an Occurrence Data File before uploading</a>
</li>
<li>
<a class="dropdown-item" href="../taxon-group-uploading/">Uploading a new Taxon Group (Module) and adding a Master List of Taxa for the Taxon Group</a>
</li>
<li>
<a class="dropdown-item" href="../occurrence-data-uploading/">Uploading Occurrence Data</a>
</li>
<li>
<a class="dropdown-item" href="../havesting-gbif-data/">Harvesting GBIF Data</a>
</li>
<li>
<a class="dropdown-item" href="../taxa-management/">Managing taxa in Taxon Management</a>
</li>
</ul>
</li>
<li class="dropdown-submenu">
<a class="dropdown-item" href="#">Working with GeoServer</a>
<ul class="dropdown-menu">
<li>
<a class="dropdown-item" href="../../geoserver/geoserver-overview/">GeoServer Overview</a>
</li>
<li>
<a class="dropdown-item" href="../../geoserver/loading-postgis-layers/">Loading layers into a PostgreSQL database</a>
</li>
<li>
<a class="dropdown-item" href="../../geoserver/publishing-layers-in-geoserver/">Publishing layers in GeoServer</a>
</li>
<li>
<a class="dropdown-item" href="../../geoserver/styling-layers-in-geoserver/">Styling layers in GeoServer</a>
</li>
<li>
<a class="dropdown-item" href="../../geoserver/visualising-geoserver-layers-in-qgis/">Visualising GeoServer layers in QGIS</a>
</li>
</ul>
</li>
<li class="dropdown-submenu">
<a class="dropdown-item" href="#">GIS Data in BIMS</a>
<ul class="dropdown-menu">
<li>
<a class="dropdown-item" href="../geocontext-overview/">GeoContext Overview</a>
</li>
<li>
<a class="dropdown-item" href="../geocontext-layers/">GeoContext and Visualisation Layers</a>
</li>
<li>
<a class="dropdown-item" href="../geocontext-data/">Working with GeoContext Data</a>
</li>
<li>
<a class="dropdown-item active" href="./">Harvesting GeoContext Data</a>
</li>
</ul>
</li>
</ul>
</li>
<li class="dropdown">
<a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">Resources <b class="caret"></b></a>
<ul class="dropdown-menu">
<li>
<a class="dropdown-item" href="../../contributing/">Contributing</a>
</li>
<li>
<a class="dropdown-item" href="../../media/">Media</a>
</li>
<li>
<a class="dropdown-item" href="../../links/">Links</a>
</li>
</ul>
</li>
</ul>
<ul class="nav navbar-nav ml-auto">
<li class="nav-item">
<a class="nav-link" href="../geocontext-data/" rel="prev">
<i class="fa fa-arrow-left"></i> Previous
                                </a>
</li>
<li class="nav-item">
<a class="nav-link" href="../../contributing/" rel="next">
                                    Next <i class="fa fa-arrow-right"></i>
</a>
</li>
<li class="nav-item">
<a class="nav-link" href="https://github.com/kartoza/bims-website/blob/main/docs/admin/geocontext-harvesting.md">Edit on BIMS Website</a>
</li>
</ul>
</div>
</div>
</div>
<div class="container">
<div class="row">
<div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
<div class="navbar-header">
<button class="navbar-toggler collapsed" data-target="#toc-collapse" data-toggle="collapse" title="Table of Contents" type="button">
<span class="fa fa-angle-down"></span>
</button>
</div>
<div class="navbar-collapse collapse card bg-secondary" id="toc-collapse">
<ul class="nav flex-column">
<li class="nav-item" data-level="1"><a class="nav-link" href="#harvesting-geocontext-data-in-bims">Harvesting GeoContext Data in BIMS</a>
<ul class="nav flex-column">
<li class="nav-item" data-level="2"><a class="nav-link" href="#configuring-geocontext-settings-for-geocontext">Configuring geocontext settings for GeoContext</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-level="2"><a class="nav-link" href="#creating-a-location-context-group-in-bims">Creating a Location Context Group in BIMS</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-level="2"><a class="nav-link" href="#creating-a-location-context-group-filter-in-bims">Creating a Location Context Group Filter in BIMS</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-level="2"><a class="nav-link" href="#configuring-the-order-of-location-context-groups">Configuring the order of Location Context Groups</a>
<ul class="nav flex-column">
</ul>
</li>
</ul>
</li>
<li class="nav-item" data-level="1"><a class="nav-link" href="#updating-geocontext-data-for-sites-using-the-admin-panel">Updating GeoContext data for sites using the admin panel</a>
<ul class="nav flex-column">
</ul>
</li>
</ul>
</div>
</div></div>
<div class="col-md-9" role="main">
<h1 id="harvesting-geocontext-data-in-bims">Harvesting GeoContext Data in BIMS</h1>
<p>In this section we explain the process of configuring BIMS to harvest GeoContext data from a GeoContext server for a collection of layers.</p>
<p><img alt="BIMS GeoContext Harvesting" src="../img/BIMSGeoContextHarvesting.width-800.png"/></p>
<h2 id="configuring-geocontext-settings-for-geocontext">Configuring geocontext settings for GeoContext</h2>
<p>This section describes how to configure your geocontext settings to harvest GeoContext data for each site.</p>
<p><img alt="BIMS GeoContext Harvesting Settings" src="../img/BIMSGeoContextHarvestingSettings.width-800.png"/></p>
<p>Open geocontext settings in admin page
Find Geocontext group keys field</p>
<p><img alt="image" src="https://user-images.githubusercontent.com/1979569/181168738-d0af2f93-3110-44c6-9a68-3192204f004e.png"/></p>
<ul>
<li>Add the GeoContext group keys in this field, use commas to separate multiple keys</li>
<li>Click <strong>Save</strong> when you're done</li>
<li>Now the system will check these keys to fetch GeoContext data for new sites</li>
</ul>
<blockquote>
<p>Make sure that the key exists in the GeoContext, to check you can use this api : <a href="GeoContext API">https://staging.geocontext.kartoza.com/api/v1/geocontext/value/group/1/1/{geocontext_key}/</a> change the geocontext_key in the url with the key you want to check</p>
</blockquote>
<h2 id="creating-a-location-context-group-in-bims">Creating a Location Context Group in BIMS</h2>
<p>In this section we explain how to create a location context group in the django admin interface for BIMS.</p>
<p><img alt="BIMS GeoContext Harvesting Location Context Group" src="../img/BIMSGeoContextHarvestingLocationContextGroup.width-800.png"/>)</p>
<p>To create a Location Context Group in BIMS, you need to know what layers are returned from the GeoContext group.</p>
<p>For instance, we want to create Location Context Group for Rwanda Catchments.</p>
<p>First, check the output from GeoContext with this API :
<a href="https://staging.geocontext.kartoza.com/api/v2/query?registry=group&amp;key=river_catchment_areas_group&amp;x=24&amp;y=-29&amp;outformat=json">https://staging.geocontext.kartoza.com/api/v2/query?registry=group&amp;key=river_catchment_areas_group&amp;x=24&amp;y=-29&amp;outformat=json</a></p>
<p>Note : Change river_catchment_areas_group in the url with GeoContext group you want to add.</p>
<p>You will receive this data from GeoContext :</p>
<p><img alt="image" src="https://user-images.githubusercontent.com/1979569/180606923-1b4a2336-3d6b-4a0b-a4e0-356795326804.png"/></p>
<p>There are two service registry values (layers), so you need to add them both to the Location Context Group to display all those layers in the filter.</p>
<p>To add those layers please follow these steps :</p>
<p>Note : We will use this data for the following steps</p>
<p><img alt="2020-09-08_14-13.png" src="../img/2020-09-08_14-13.width-800.png"/></p>
<ul>
<li>Open Location Context Groups admin page</li>
<li>Click Add location context group button at the top right corner</li>
<li>Fill out these fields :</li>
<li><strong>Name</strong> - Name of the layer, Rwanda Catchments Level 1</li>
<li><strong>Key</strong> - Layer key, rwanda_catchments_level_1</li>
<li><strong>Geocontext group key</strong> - Group key from GeoContext, rwanda_catchments</li>
<li>Click <strong>Save</strong></li>
</ul>
<p>Then you need to do the same thing for other layer.</p>
<p><img alt="2020-09-08_14-19.png" src="../img/2020-09-08_14-19.width-800.png"/></p>
<p>If you've done it correctly, then you will have two new layers in Location Context Group admin page :</p>
<p><img alt="2020-09-08_14-26.png" src="../img/2020-09-08_14-26.width-800.png"/></p>
<h2 id="creating-a-location-context-group-filter-in-bims">Creating a Location Context Group Filter in BIMS</h2>
<p>In this section we explain how to create a Location Context Filter in BIMS.</p>
<p><img alt="BIMS GeoContext Harvesting Location Context Group Filter" src="../img/BIMSGeoContextHarvestingLocationContextGroupFi.width-800.png"/></p>
<p>Location context filter is just the filter name for the spatial filter on the Map page.</p>
<p><img alt="2020-09-08_14-31.png" src="../img/2020-09-08_14-31.width-800.png"/></p>
<p>To add groups (Rwanda Catchments Level 1 &amp; Rwanda Catchment Level 2) to the Location context filter please follow this guide.</p>
<p>To add new Location context filter please follow these steps :</p>
<ul>
<li>Open the Location context filter admin page</li>
<li>Click Add location context filter button at the top right</li>
<li>Fill up these required fields :</li>
<li><strong>Name</strong> - Name of the location context filter</li>
<li><strong>Display order</strong> - Order of this location context filter</li>
<li>Click <code>Save</code> when you've done</li>
</ul>
<h2 id="configuring-the-order-of-location-context-groups">Configuring the order of Location Context Groups</h2>
<p>In this section we describe the process of sorting Location Context Groups to control the order in which they appear in BIMS.</p>
<p><img alt="BIMS GeoContext Harvesting Group Order" src="../img/BIMSGeoContextHarvestingGroupOrder.width-800.png"/></p>
<p>To do this guide, you need to add Location Context Group and Location Context Group Filter beforehand.</p>
<p>Open the admin page for Location Context Filter Group Order
Click Add location context group order button at the top right
Fill up these fields :</p>
<p>Group - Choose Location Context Group you want to show in the filter panel
<img alt="2020-09-08_14-53.png" src="../img/2020-09-08_14-53.width-800.png"/></p>
<p>Filter - Choose Location Filter you want to show in the filter panel
<img alt="2020-09-08_14-52.png" src="../img/2020-09-08_14-52.width-800.png"/></p>
<p>Group display order - This is the order of the groups inside the location filter
<img alt="2020-09-08_14-54.png" src="../img/2020-09-08_14-54.width-800.png"/></p>
<p>Show in dashboard (optional) - Whether to show this data in the dashboard or not
<img alt="2020-09-08_14-56.png" src="../img/2020-09-08_14-56.width-800.png"/></p>
<p>Show in side panel (optional) - Whether to show this data in the side panel or not
<img alt="2020-09-08_14-57.png" src="../img/2020-09-08_14-57.width-800.png"/></p>
<p>Click <strong>Save</strong> when you've done.</p>
<h1 id="updating-geocontext-data-for-sites-using-the-admin-panel">Updating GeoContext data for sites using the admin panel</h1>
<p>In this article we describe the process of updating the GeoContext data in one or more sites using the admin panel.</p>
<p><img alt="BIMS GeoContext Harvesting Admin Command" src="../img/BIMSGeoContextHarvestingAdminCommand.width-800.png"/></p>
<p>To update GeoContext data for existing sites please follow these steps : 
* Open Location Sites admin page 
* Select the sites you want to update the geocontext data</p>
<p><img alt="BIMS Location Site Update Geocontext" src="../img/location_sites_update_geocontext_1.png"/></p>
<ul>
<li>Select 'Update location context data for selected sites in background.' in the dropdown located at the bottom of the page</li>
</ul>
<p><img alt="BIMS Location Site Update Geocontext Command" src="../img/location_sites_update_geocontext_2.png"/></p>
<ul>
<li>Click <strong>Go</strong>. The system will try to update the geocontext data in the background</li>
<li>To see the geocontext status open one of the previously selected location sites, scroll down to location context section to view all geocontext data and check if your geocontext data has been retrieved : </li>
</ul>
<p><img alt="BIMS Location Site Update Geocontext Status" src="../img/location_sites_update_geocontext_3.png"/></p></div>
</div>
</div>
<footer class="col-md-12">
<hr/>
<p>Kartoza and FRC</p>
<p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
</footer>
<script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
<script defer="" src="../../js/base.js"></script>
<div aria-hidden="true" aria-labelledby="keyboardModalLabel" class="modal" id="mkdocs_keyboard_modal" role="dialog" tabindex="-1">
<div class="modal-dialog">
<div class="modal-content">
<div class="modal-header">
<h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
<button class="close" data-dismiss="modal" type="button"><span aria-hidden="true">×</span><span class="sr-only">Close</span></button>
</div>
<div class="modal-body">
<table class="table">
<thead>
<tr>
<th style="width: 20%;">Keys</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr>
<td class="help shortcut"><kbd>?</kbd></td>
<td>Open this help</td>
</tr>
<tr>
<td class="next shortcut"><kbd>n</kbd></td>
<td>Next page</td>
</tr>
<tr>
<td class="prev shortcut"><kbd>p</kbd></td>
<td>Previous page</td>
</tr>
<tr>
<td class="search shortcut"><kbd>s</kbd></td>
<td>Search</td>
</tr>
</tbody>
</table>
</div>
<div class="modal-footer">
</div>
</div>
</div>
</div>
</body>
</html>
